<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSeek + Qdrant API æµ‹è¯•å·¥å…·</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { margin-bottom: 10px; font-size: 2.2em; }
        .header p { opacity: 0.9; font-size: 1.1em; }
        .nav {
            background: #f8f9fa;
            padding: 0;
            display: flex;
            overflow-x: auto;
        }
        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
            font-weight: 500;
        }
        .nav-item:hover { background: #e9ecef; }
        .nav-item.active {
            background: #007bff;
            color: white;
            border-bottom-color: #0056b3;
        }
        .content { padding: 30px; }
        .api-section {
            display: none;
            animation: fadeIn 0.5s;
        }
        .api-section.active { display: block; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
        }
        textarea.form-control {
            resize: vertical;
            min-height: 80px;
        }
        .btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.4);
        }
        .btn:active { transform: translateY(0); }
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(220,53,69,0.4);
        }
        .result {
            margin-top: 25px;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .col { flex: 1; }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .status-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .status-card h4 {
            margin-bottom: 15px;
            color: #495057;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .status-value.online { color: #28a745; font-weight: bold; }
        .status-value.offline { color: #dc3545; font-weight: bold; }
        .memory-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .memory-meta {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 8px;
        }
        .memory-actions {
            margin-top: 10px;
        }
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }
        .loading {
            display: inline-block;
            margin-left: 10px;
        }
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007bff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .quick-examples {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .quick-examples h4 {
            margin-bottom: 10px;
            color: #1976d2;
        }
        .example-btn {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin: 4px;
            font-size: 12px;
        }
        .example-btn:hover {
            background: #bbdefb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  DeepSeek + Qdrant API æµ‹è¯•å·¥å…·</h1>
            <p>äº¤äº’å¼ API æ¥å£æµ‹è¯•å¹³å° - æœåŠ¡ç«¯å£: 9000</p>
        </div>
        
        <div class="nav">
            <div class="nav-item active" onclick="showSection('add')">ğŸ’¾ æ·»åŠ è®°å¿†</div>
            <div class="nav-item" onclick="showSection('search')">ğŸ” æœç´¢è®°å¿†</div>
            <div class="nav-item" onclick="showSection('list')">ğŸ“š æ‰€æœ‰è®°å¿†</div>
            <div class="nav-item" onclick="showSection('delete')">ğŸ—‘ï¸ åˆ é™¤è®°å¿†</div>
            <div class="nav-item" onclick="showSection('status')">ğŸ“Š ç³»ç»ŸçŠ¶æ€</div>
            <div class="nav-item" onclick="showSection('batch')">âš¡ æ‰¹é‡æ“ä½œ</div>
        </div>
        
        <div class="content">
            <!-- æ·»åŠ è®°å¿† -->
            <div class="api-section active" id="add">
                <h3>ğŸ’¾ æ·»åŠ è®°å¿†</h3>
                <p style="margin-bottom: 20px; color: #6c757d;">å‘ç³»ç»Ÿä¸­æ·»åŠ æ–°çš„è®°å¿†å†…å®¹</p>
                
                <div class="quick-examples">
                    <h4>å¿«é€Ÿç¤ºä¾‹</h4>
                    <button class="example-btn" onclick="fillAddExample('work')">å·¥ä½œä¿¡æ¯</button>
                    <button class="example-btn" onclick="fillAddExample('hobby')">å…´è¶£çˆ±å¥½</button>
                    <button class="example-btn" onclick="fillAddExample('skill')">æŠ€èƒ½ç»éªŒ</button>
                    <button class="example-btn" onclick="fillAddExample('learning')">å­¦ä¹ ç¬”è®°</button>
                </div>
                
                <div class="form-group">
                    <label>è®°å¿†å†…å®¹ *</label>
                    <textarea id="addText" class="form-control" rows="4" placeholder="è¾“å…¥è¦è®°ä½çš„å†…å®¹..."></textarea>
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label>ç”¨æˆ·ID</label>
                            <input type="text" id="addUserId" class="form-control" value="demo_user" placeholder="ç”¨æˆ·æ ‡è¯†">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>å…ƒæ•°æ® (JSONæ ¼å¼ï¼Œå¯é€‰)</label>
                            <textarea id="addMetadata" class="form-control" placeholder='{"type": "åˆ†ç±»", "source": "æ¥æº"}'></textarea>
                        </div>
                    </div>
                </div>
                
                <button class="btn" onclick="addMemory()">
                    ğŸ’¾ æ·»åŠ è®°å¿†
                    <div class="loading" id="addLoading" style="display: none;"><div class="spinner"></div></div>
                </button>
                
                <div id="addResult" class="result" style="display: none;"></div>
            </div>
            
            <!-- æœç´¢è®°å¿† -->
            <div class="api-section" id="search">
                <h3>ğŸ” æœç´¢è®°å¿†</h3>
                <p style="margin-bottom: 20px; color: #6c757d;">æ ¹æ®å…³é”®è¯æœç´¢ç›¸å…³çš„è®°å¿†å†…å®¹</p>
                
                <div class="quick-examples">
                    <h4>æœç´¢ç¤ºä¾‹</h4>
                    <button class="example-btn" onclick="fillSearchExample('python')">Python å¼€å‘</button>
                    <button class="example-btn" onclick="fillSearchExample('ai')">äººå·¥æ™ºèƒ½</button>
                    <button class="example-btn" onclick="fillSearchExample('work')">å·¥ä½œç›¸å…³</button>
                    <button class="example-btn" onclick="fillSearchExample('study')">å­¦ä¹ ç¬”è®°</button>
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label>æœç´¢å…³é”®è¯ *</label>
                            <input type="text" id="searchQuery" class="form-control" placeholder="è¾“å…¥æœç´¢å…³é”®è¯...">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>ç”¨æˆ·ID</label>
                            <input type="text" id="searchUserId" class="form-control" value="demo_user" placeholder="ç”¨æˆ·æ ‡è¯†">
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>ç»“æœæ•°é‡</label>
                            <input type="number" id="searchLimit" class="form-control" value="5" min="1" max="20">
                        </div>
                    </div>
                </div>
                
                <button class="btn" onclick="searchMemories()">
                    ğŸ” æœç´¢è®°å¿†
                    <div class="loading" id="searchLoading" style="display: none;"><div class="spinner"></div></div>
                </button>
                
                <div id="searchResult" class="result" style="display: none;"></div>
                <div id="searchMemories" style="margin-top: 20px;"></div>
            </div>
            
            <!-- æ‰€æœ‰è®°å¿† -->
            <div class="api-section" id="list">
                <h3>ğŸ“š æ‰€æœ‰è®°å¿†</h3>
                <p style="margin-bottom: 20px; color: #6c757d;">è·å–æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰è®°å¿†å†…å®¹</p>
                
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label>ç”¨æˆ·ID *</label>
                            <input type="text" id="listUserId" class="form-control" value="demo_user" placeholder="ç”¨æˆ·æ ‡è¯†">
                        </div>
                    </div>
                    <div class="col" style="display: flex; align-items: end;">
                        <button class="btn" onclick="listMemories()">
                            ğŸ“š è·å–æ‰€æœ‰è®°å¿†
                            <div class="loading" id="listLoading" style="display: none;"><div class="spinner"></div></div>
                        </button>
                    </div>
                </div>
                
                <div id="listResult" class="result" style="display: none;"></div>
                <div id="listMemories" style="margin-top: 20px;"></div>
            </div>
            
            <!-- åˆ é™¤è®°å¿† -->
            <div class="api-section" id="delete">
                <h3>ğŸ—‘ï¸ åˆ é™¤è®°å¿†</h3>
                <p style="margin-bottom: 20px; color: #6c757d;">åˆ é™¤æŒ‡å®šçš„è®°å¿†å†…å®¹</p>
                
                <div class="form-group">
                    <label>è®°å¿†ID *</label>
                    <input type="text" id="deleteMemoryId" class="form-control" placeholder="è¾“å…¥è¦åˆ é™¤çš„è®°å¿†ID...">
                </div>
                
                <button class="btn btn-danger" onclick="deleteMemory()">
                    ğŸ—‘ï¸ åˆ é™¤è®°å¿†
                    <div class="loading" id="deleteLoading" style="display: none;"><div class="spinner"></div></div>
                </button>
                
                <div id="deleteResult" class="result" style="display: none;"></div>
            </div>
            
            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div class="api-section" id="status">
                <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
                <p style="margin-bottom: 20px; color: #6c757d;">æŸ¥çœ‹ç³»ç»Ÿå„ç»„ä»¶çš„è¿è¡ŒçŠ¶æ€</p>
                
                <button class="btn" onclick="getStatus()">
                    ğŸ“Š æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
                    <div class="loading" id="statusLoading" style="display: none;"><div class="spinner"></div></div>
                </button>
                
                <div id="statusResult" class="result" style="display: none;"></div>
                <div id="statusCards" style="margin-top: 20px;"></div>
            </div>
            
            <!-- æ‰¹é‡æ“ä½œ -->
            <div class="api-section" id="batch">
                <h3>âš¡ æ‰¹é‡æ“ä½œ</h3>
                <p style="margin-bottom: 20px; color: #6c757d;">æ‰¹é‡æ·»åŠ ç¤ºä¾‹æ•°æ®å’Œæ‰¹é‡æµ‹è¯•åŠŸèƒ½</p>
                
                <div class="row">
                    <div class="col">
                        <h4>æ‰¹é‡æ·»åŠ ç¤ºä¾‹æ•°æ®</h4>
                        <p style="color: #6c757d; margin-bottom: 15px;">æ·»åŠ ä¸€ç»„é¢„è®¾çš„ä¸­æ–‡ç¤ºä¾‹è®°å¿†</p>
                        <button class="btn" onclick="batchAddSamples()">
                            ğŸ’¾ æ‰¹é‡æ·»åŠ ç¤ºä¾‹
                            <div class="loading" id="batchAddLoading" style="display: none;"><div class="spinner"></div></div>
                        </button>
                    </div>
                    <div class="col">
                        <h4>å…¨åŠŸèƒ½æµ‹è¯•</h4>
                        <p style="color: #6c757d; margin-bottom: 15px;">æµ‹è¯•æ‰€æœ‰ API æ¥å£åŠŸèƒ½</p>
                        <button class="btn" onclick="runFullTest()">
                            ğŸ§ª è¿è¡Œå®Œæ•´æµ‹è¯•
                            <div class="loading" id="fullTestLoading" style="display: none;"><div class="spinner"></div></div>
                        </button>
                    </div>
                </div>
                
                <div id="batchResult" class="result" style="display: none;"></div>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:9000/api';
        
        // æ˜¾ç¤ºæŒ‡å®šsection
        function showSection(sectionId) {
            // éšè—æ‰€æœ‰section
            document.querySelectorAll('.api-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰nav-itemçš„activeç±»
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // æ˜¾ç¤ºæŒ‡å®šsection
            document.getElementById(sectionId).classList.add('active');
            
            // è®¾ç½®å¯¹åº”nav-itemä¸ºactive
            event.target.classList.add('active');
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, data, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
            element.style.display = 'block';
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(loadingId, show = true) {
            document.getElementById(loadingId).style.display = show ? 'inline-block' : 'none';
        }
        
        // å¡«å……æ·»åŠ è®°å¿†ç¤ºä¾‹
        function fillAddExample(type) {
            const examples = {
                'work': {
                    text: 'æˆ‘åœ¨ä¸€å®¶AIç§‘æŠ€å…¬å¸æ‹…ä»»æœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆï¼Œä¸»è¦è´Ÿè´£è‡ªç„¶è¯­è¨€å¤„ç†å’Œè®¡ç®—æœºè§†è§‰é¡¹ç›®çš„å¼€å‘',
                    metadata: '{"type": "å·¥ä½œ", "category": "èŒä¸šä¿¡æ¯", "field": "äººå·¥æ™ºèƒ½"}'
                },
                'hobby': {
                    text: 'æˆ‘å–œæ¬¢åœ¨å‘¨æœ«é˜…è¯»ç§‘æŠ€ç±»ä¹¦ç±å’ŒæŠ€æœ¯åšå®¢ï¼Œç‰¹åˆ«å…³æ³¨æœ€æ–°çš„AIæŠ€æœ¯å‘å±•å’Œå¼€æºé¡¹ç›®',
                    metadata: '{"type": "çˆ±å¥½", "category": "ä¸ªäººå…´è¶£", "frequency": "å‘¨æœ«"}'
                },
                'skill': {
                    text: 'æˆ‘ç²¾é€šPythonã€TensorFlowå’ŒPyTorchï¼Œæœ‰5å¹´çš„æ·±åº¦å­¦ä¹ é¡¹ç›®ç»éªŒï¼Œæ“…é•¿æ„å»ºç«¯åˆ°ç«¯çš„AIåº”ç”¨',
                    metadata: '{"type": "æŠ€èƒ½", "category": "ä¸“ä¸šèƒ½åŠ›", "level": "é«˜çº§"}'
                },
                'learning': {
                    text: 'ä»Šå¤©å­¦ä¹ äº†Transformeræ¶æ„çš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œç†è§£äº†self-attentionå¦‚ä½•å¤„ç†åºåˆ—æ•°æ®ä¸­çš„é•¿ç¨‹ä¾èµ–å…³ç³»',
                    metadata: '{"type": "å­¦ä¹ ", "category": "æŠ€æœ¯ç¬”è®°", "topic": "æ·±åº¦å­¦ä¹ "}'
                }
            };
            
            const example = examples[type];
            document.getElementById('addText').value = example.text;
            document.getElementById('addMetadata').value = example.metadata;
        }
        
        // å¡«å……æœç´¢ç¤ºä¾‹
        function fillSearchExample(type) {
            const examples = {
                'python': 'Pythonå¼€å‘',
                'ai': 'äººå·¥æ™ºèƒ½',
                'work': 'å·¥ä½œç»éªŒ',
                'study': 'å­¦ä¹ ç¬”è®°'
            };
            
            document.getElementById('searchQuery').value = examples[type];
        }
        
        // æ·»åŠ è®°å¿†
        async function addMemory() {
            const text = document.getElementById('addText').value.trim();
            const userId = document.getElementById('addUserId').value.trim();
            const metadataText = document.getElementById('addMetadata').value.trim();
            
            if (!text) {
                showResult('addResult', 'è¯·è¾“å…¥è®°å¿†å†…å®¹', 'error');
                return;
            }
            
            let metadata = {};
            if (metadataText) {
                try {
                    metadata = JSON.parse(metadataText);
                } catch (e) {
                    showResult('addResult', 'å…ƒæ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨æ­£ç¡®çš„JSONæ ¼å¼', 'error');
                    return;
                }
            }
            
            showLoading('addLoading', true);
            
            try {
                const response = await fetch(`${API_BASE}/memories`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text,
                        user_id: userId || 'default_user',
                        metadata: metadata
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('addResult', `âœ… è®°å¿†æ·»åŠ æˆåŠŸï¼\n\n${JSON.stringify(data, null, 2)}`, 'success');
                    // æ¸…ç©ºè¾“å…¥æ¡†
                    document.getElementById('addText').value = '';
                    document.getElementById('addMetadata').value = '';
                } else {
                    showResult('addResult', `âŒ æ·»åŠ å¤±è´¥: ${data.detail}`, 'error');
                }
            } catch (error) {
                showResult('addResult', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            } finally {
                showLoading('addLoading', false);
            }
        }
        
        // æœç´¢è®°å¿†
        async function searchMemories() {
            const query = document.getElementById('searchQuery').value.trim();
            const userId = document.getElementById('searchUserId').value.trim();
            const limit = parseInt(document.getElementById('searchLimit').value);
            
            if (!query) {
                showResult('searchResult', 'è¯·è¾“å…¥æœç´¢å…³é”®è¯', 'error');
                return;
            }
            
            showLoading('searchLoading', true);
            
            try {
                const response = await fetch(`${API_BASE}/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: query,
                        user_id: userId || 'default_user',
                        limit: limit || 5
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('searchResult', `âœ… æœç´¢å®Œæˆï¼æ‰¾åˆ° ${data.memories.length} æ¡ç›¸å…³è®°å¿†`, 'success');
                    displayMemories('searchMemories', data.memories, true);
                } else {
                    showResult('searchResult', `âŒ æœç´¢å¤±è´¥: ${data.detail}`, 'error');
                }
            } catch (error) {
                showResult('searchResult', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            } finally {
                showLoading('searchLoading', false);
            }
        }
        
        // è·å–æ‰€æœ‰è®°å¿†
        async function listMemories() {
            const userId = document.getElementById('listUserId').value.trim();
            
            if (!userId) {
                showResult('listResult', 'è¯·è¾“å…¥ç”¨æˆ·ID', 'error');
                return;
            }
            
            showLoading('listLoading', true);
            
            try {
                const response = await fetch(`${API_BASE}/memories/${userId}`);
                const data = await response.json();
                
                if (response.ok) {
                    showResult('listResult', `âœ… è·å–æˆåŠŸï¼å…±æœ‰ ${data.memories.length} æ¡è®°å¿†`, 'success');
                    displayMemories('listMemories', data.memories, false);
                } else {
                    showResult('listResult', `âŒ è·å–å¤±è´¥: ${data.detail}`, 'error');
                }
            } catch (error) {
                showResult('listResult', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            } finally {
                showLoading('listLoading', false);
            }
        }
        
        // åˆ é™¤è®°å¿†
        async function deleteMemory() {
            const memoryId = document.getElementById('deleteMemoryId').value.trim();
            
            if (!memoryId) {
                showResult('deleteResult', 'è¯·è¾“å…¥è®°å¿†ID', 'error');
                return;
            }
            
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å¿†å—ï¼Ÿ')) {
                return;
            }
            
            showLoading('deleteLoading', true);
            
            try {
                const response = await fetch(`${API_BASE}/memories/${memoryId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('deleteResult', `âœ… åˆ é™¤æˆåŠŸï¼\n\n${JSON.stringify(data, null, 2)}`, 'success');
                    document.getElementById('deleteMemoryId').value = '';
                } else {
                    showResult('deleteResult', `âŒ åˆ é™¤å¤±è´¥: ${data.detail}`, 'error');
                }
            } catch (error) {
                showResult('deleteResult', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            } finally {
                showLoading('deleteLoading', false);
            }
        }
        
        // è·å–ç³»ç»ŸçŠ¶æ€
        async function getStatus() {
            showLoading('statusLoading', true);
            
            try {
                const response = await fetch(`${API_BASE}/status`);
                const data = await response.json();
                
                if (response.ok) {
                    showResult('statusResult', 'âœ… ç³»ç»ŸçŠ¶æ€è·å–æˆåŠŸ', 'success');
                    displayStatusCards(data);
                } else {
                    showResult('statusResult', `âŒ è·å–çŠ¶æ€å¤±è´¥: ${response.statusText}`, 'error');
                }
            } catch (error) {
                showResult('statusResult', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            } finally {
                showLoading('statusLoading', false);
            }
        }
        
        // æ˜¾ç¤ºè®°å¿†åˆ—è¡¨
        function displayMemories(containerId, memories, showScore = false) {
            const container = document.getElementById(containerId);
            
            if (memories.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">æš‚æ— è®°å¿†æ•°æ®</p>';
                return;
            }
            
            let html = '';
            memories.forEach((memory, index) => {
                html += `
                    <div class="memory-item">
                        <div><strong>${index + 1}.</strong> ${memory.memory}</div>
                        <div class="memory-meta">
                            <span>ID: ${memory.id.substring(0, 12)}...</span>
                            ${showScore && memory.score ? `<span style="margin-left: 15px;">ç›¸å…³åº¦: ${memory.score.toFixed(4)}</span>` : ''}
                            ${memory.metadata ? `<span style="margin-left: 15px;">æ ‡ç­¾: ${JSON.stringify(memory.metadata)}</span>` : ''}
                        </div>
                        <div class="memory-actions">
                            <button class="btn btn-sm btn-danger" onclick="deleteMemoryById('${memory.id}')">åˆ é™¤</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // é€šè¿‡IDåˆ é™¤è®°å¿†
        async function deleteMemoryById(memoryId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å¿†å—ï¼Ÿ')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/memories/${memoryId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('âœ… åˆ é™¤æˆåŠŸï¼');
                    // åˆ·æ–°å½“å‰é¡µé¢çš„è®°å¿†åˆ—è¡¨
                    if (document.getElementById('search').classList.contains('active')) {
                        searchMemories();
                    } else if (document.getElementById('list').classList.contains('active')) {
                        listMemories();
                    }
                } else {
                    const data = await response.json();
                    alert(`âŒ åˆ é™¤å¤±è´¥: ${data.detail}`);
                }
            } catch (error) {
                alert(`âŒ ç½‘ç»œé”™è¯¯: ${error.message}`);
            }
        }
        
        // æ˜¾ç¤ºçŠ¶æ€å¡ç‰‡
        function displayStatusCards(status) {
            const container = document.getElementById('statusCards');
            
            const html = `
                <div class="status-grid">
                    <div class="status-card">
                        <h4>ğŸ—„ï¸ å‘é‡æ•°æ®åº“</h4>
                        <div class="status-item">
                            <span>Qdrant çŠ¶æ€:</span>
                            <span class="status-value ${status.qdrant_status ? 'online' : 'offline'}">
                                ${status.qdrant_status ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸'}
                            </span>
                        </div>
                        <div class="status-item">
                            <span>é›†åˆåç§°:</span>
                            <span class="status-value">${status.collection_name}</span>
                        </div>
                    </div>
                    
                    <div class="status-card">
                        <h4>ğŸ§  è®°å¿†ç³»ç»Ÿ</h4>
                        <div class="status-item">
                            <span>ç³»ç»ŸçŠ¶æ€:</span>
                            <span class="status-value ${status.memory_system ? 'online' : 'offline'}">
                                ${status.memory_system ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸'}
                            </span>
                        </div>
                        <div class="status-item">
                            <span>LLM æ¨¡å‹:</span>
                            <span class="status-value">${status.llm_model}</span>
                        </div>
                    </div>
                    
                    <div class="status-card">
                        <h4>ğŸ“Š åµŒå…¥æ¨¡å‹</h4>
                        <div class="status-item">
                            <span>æ¨¡å‹åç§°:</span>
                            <span class="status-value">${status.embedder_model}</span>
                        </div>
                        <div class="status-item">
                            <span>ç±»å‹:</span>
                            <span class="status-value">ä¸­æ–‡ä¼˜åŒ–</span>
                        </div>
                    </div>
                    
                    <div class="status-card">
                        <h4>ğŸŒ æœåŠ¡ä¿¡æ¯</h4>
                        <div class="status-item">
                            <span>API ç«¯å£:</span>
                            <span class="status-value">9000</span>
                        </div>
                        <div class="status-item">
                            <span>Qdrant ç«¯å£:</span>
                            <span class="status-value">6333</span>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // æ‰¹é‡æ·»åŠ ç¤ºä¾‹æ•°æ®
        async function batchAddSamples() {
            const samples = [
                {
                    text: "æˆ‘æ˜¯ä¸€åAIå·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºè‡ªç„¶è¯­è¨€å¤„ç†å’Œæœºå™¨å­¦ä¹ åº”ç”¨å¼€å‘",
                    metadata: {"type": "å·¥ä½œ", "category": "èŒä¸šä¿¡æ¯"}
                },
                {
                    text: "æˆ‘ç²¾é€šPythonã€TensorFlowå’ŒPyTorchï¼Œæœ‰ä¸°å¯Œçš„æ·±åº¦å­¦ä¹ é¡¹ç›®ç»éªŒ",
                    metadata: {"type": "æŠ€èƒ½", "category": "ä¸“ä¸šèƒ½åŠ›"}
                },
                {
                    text: "æˆ‘å–œæ¬¢é˜…è¯»æœ€æ–°çš„AIè®ºæ–‡ï¼Œç‰¹åˆ«å…³æ³¨Transformeræ¶æ„å’Œå¤§è¯­è¨€æ¨¡å‹çš„å‘å±•",
                    metadata: {"type": "å­¦ä¹ ", "category": "å…´è¶£çˆ±å¥½"}
                },
                {
                    text: "æˆ‘ç»å¸¸ä½¿ç”¨Qdrantä½œä¸ºå‘é‡æ•°æ®åº“ï¼Œå®ƒçš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§éƒ½å¾ˆå‡ºè‰²",
                    metadata: {"type": "æŠ€æœ¯", "category": "å·¥å…·åå¥½"}
                },
                {
                    text: "æˆ‘ä½åœ¨æ·±åœ³ï¼Œç»å¸¸å‚åŠ å½“åœ°çš„AIæŠ€æœ¯äº¤æµä¼šå’Œå¼€æºé¡¹ç›®è®¨è®º",
                    metadata: {"type": "ç”Ÿæ´»", "category": "ç¤¾äº¤æ´»åŠ¨"}
                }
            ];
            
            showLoading('batchAddLoading', true);
            let results = [];
            
            try {
                for (const sample of samples) {
                    const response = await fetch(`${API_BASE}/memories`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            text: sample.text,
                            user_id: 'demo_user',
                            metadata: sample.metadata
                        })
                    });
                    
                    const data = await response.json();
                    results.push({
                        text: sample.text.substring(0, 50) + '...',
                        success: response.ok,
                        result: data
                    });
                }
                
                const successCount = results.filter(r => r.success).length;
                showResult('batchResult', 
                    `âœ… æ‰¹é‡æ·»åŠ å®Œæˆï¼\næˆåŠŸ: ${successCount}/${samples.length} æ¡\n\nè¯¦ç»†ç»“æœ:\n${results.map((r, i) => `${i+1}. ${r.text} - ${r.success ? 'âœ…' : 'âŒ'}`).join('\n')}`, 
                    'success'
                );
            } catch (error) {
                showResult('batchResult', `âŒ æ‰¹é‡æ“ä½œå¤±è´¥: ${error.message}`, 'error');
            } finally {
                showLoading('batchAddLoading', false);
            }
        }
        
        // è¿è¡Œå®Œæ•´æµ‹è¯•
        async function runFullTest() {
            showLoading('fullTestLoading', true);
            let testResults = [];
            
            try {
                // 1. æµ‹è¯•ç³»ç»ŸçŠ¶æ€
                testResults.push('ğŸ”„ æµ‹è¯•ç³»ç»ŸçŠ¶æ€...');
                const statusResponse = await fetch(`${API_BASE}/status`);
                testResults.push(`ğŸ“Š çŠ¶æ€æ£€æŸ¥: ${statusResponse.ok ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`);
                
                // 2. æµ‹è¯•æ·»åŠ è®°å¿†
                testResults.push('ğŸ”„ æµ‹è¯•æ·»åŠ è®°å¿†...');
                const addResponse = await fetch(`${API_BASE}/memories`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•è®°å¿†ï¼Œç”¨äºéªŒè¯APIåŠŸèƒ½æ˜¯å¦æ­£å¸¸',
                        user_id: 'test_user',
                        metadata: {'type': 'æµ‹è¯•', 'timestamp': new Date().toISOString()}
                    })
                });
                testResults.push(`ğŸ’¾ æ·»åŠ è®°å¿†: ${addResponse.ok ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`);
                
                // 3. æµ‹è¯•æœç´¢è®°å¿†
                testResults.push('ğŸ”„ æµ‹è¯•æœç´¢è®°å¿†...');
                const searchResponse = await fetch(`${API_BASE}/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: 'æµ‹è¯•',
                        user_id: 'test_user',
                        limit: 5
                    })
                });
                testResults.push(`ğŸ” æœç´¢è®°å¿†: ${searchResponse.ok ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`);
                
                // 4. æµ‹è¯•è·å–æ‰€æœ‰è®°å¿†
                testResults.push('ğŸ”„ æµ‹è¯•è·å–æ‰€æœ‰è®°å¿†...');
                const listResponse = await fetch(`${API_BASE}/memories/test_user`);
                testResults.push(`ğŸ“š è·å–è®°å¿†: ${listResponse.ok ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`);
                
                // 5. ç»Ÿè®¡ç»“æœ
                const passCount = testResults.filter(r => r.includes('âœ…')).length;
                const totalTests = testResults.filter(r => r.includes('âœ…') || r.includes('âŒ')).length;
                
                testResults.push('');
                testResults.push(`ğŸ“ˆ æµ‹è¯•æ€»ç»“: ${passCount}/${totalTests} é¡¹é€šè¿‡`);
                testResults.push(`ğŸ¯ æˆåŠŸç‡: ${((passCount/totalTests)*100).toFixed(1)}%`);
                
                showResult('batchResult', 
                    `ğŸ§ª å®Œæ•´æµ‹è¯•ç»“æœ:\n\n${testResults.join('\n')}`, 
                    passCount === totalTests ? 'success' : 'error'
                );
                
            } catch (error) {
                showResult('batchResult', `âŒ æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}`, 'error');
            } finally {
                showLoading('fullTestLoading', false);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        window.addEventListener('load', function() {
            setTimeout(getStatus, 1000);
        });
    </script>
</body>
</html>